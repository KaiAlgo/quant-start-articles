
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="wl3-8ed1QZjI0iYZMv10zoZWYElkMObTfwLlWIj9cpA" />
    <meta name="description" content="Monthly Rebalancing of ETFs with Fixed Initial Weights in QSTrader">

    <link rel="icon" href="/static/images/favicon.png">

    <title>Monthly Rebalancing of ETFs with Fixed Initial Weights in QSTrader | QuantStart</title>
    
    
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap" rel="stylesheet"> 
<link href="/static/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/css/prism.css" rel="stylesheet">
<link href="/static/css/qs.css?v=10" rel="stylesheet">
    
  </head>

  <body>
    <header class="header covered-header" style="background-image: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url(https://quantstartmedia.s3.amazonaws.com/images/article-images/article-backgrounds/default-bg.jpg);">
  
<nav class="nav">
  <div class="container nav-container">
    <div class="nav-row row d-flex justify-content-between align-items-center">
      <div class="col-2">
        <ul class="nav-items justify-content-end small-capitals align-items-center">
          <li class="nav-item">
            <a class="link-fade" href="/">QuantStart</a>
          </li>
        </ul>
      </div>
      <div class="col-auto col-logo">
        <ul id="top-nav-menu" class="nav-items justify-content-end align-items-center">
          
          <li class="nav-item">
            <a class="link-fade" href="/qsalpha/">QSAlpha</a>
          </li>
          
          
          <li class="nav-item">
            <a class="link-fade" href="/quantcademy/">Quantcademy</a>
          </li>
          
          <li id="menu-link-ebooks" class="nav-item">
            <a class="link-fade" href="#">Books</a>
            <div id="menu-pane-ebooks" class="nav-items menu-dropdown-pane">
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a>
              </div>
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a>
              </div>
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a>
              </div>
            </div>
          </li>
          <li class="nav-item">
            <a class="link-fade" href="/qstrader/">QSTrader</a>
          </li>
          <li class="nav-item">
            <a class="link-fade" href="/articles/">Articles</a>
          </li>
          
          <li class="nav-item">
            <a class="link-fade" href="/members/login/">Login</a>
          </li>
          
        </ul>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </div>
</nav>

<nav id="mobile-nav" class="mobile-nav text-left">
  <div class="container">
    <ul class="mt-4 ml-3 mobile-nav-menu">
      <li class="nav-item">
        <a class="link-fade d-block" href="/">QuantStart</a>
      </li>

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/qsalpha/">QSAlpha</a>
      </li>
      

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/quantcademy/">Quantcademy</a>
      </li>
      

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="#">Books</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a>
      </li>

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/qstrader/">QSTrader</a>
      </li>

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/articles/">Articles</a>
      </li>

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/members/login/">Login</a>
      </li>
      
    </ul>
    <button class="nav-toggle mobile-nav-close">
      <svg id="mobile-nav-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19.77,5.63,13.41,12l6.36,6.37a1,1,0,0,1-1.41,1.41L12,13.41,5.63,19.77a1,1,0,0,1-1.44-1.39l0,0L10.58,12,4.21,5.63a1,1,0,0,1,0-1.42,1,1,0,0,1,1.41,0l0,0L12,10.58l6.37-6.37a1,1,0,0,1,1.41,0A1,1,0,0,1,19.77,5.63Z"></path>
      </svg>
    </button>
  </div>
</nav>

  <div class="container hero-container">
    <section class="mt-5 mb-4">
      <div class="row justify-content-center">
        <div class="col-12 text-center">
          <p class="hero">Monthly Rebalancing of ETFs with Fixed Initial Weights in QSTrader</p>
          <p class="hero subhero">Monthly Rebalancing of ETFs with Fixed Initial Weights in QSTrader</p>
        </div>
      </div>
    </section>
  </div>
</header>
    
<section class="container content-container">
  <div class="row">
    <div class="col-md-8 order-md-2">
      <section class="content article-content">
        
        
        <p>Many institutional global asset managers are constrained by the need to invest in long-only strategies with zero or minimal leverage. This means that their strategies are often highly correlated to "the market" (usually the S&amp;P500 index). While it is difficult to minimise this correlation without applying a short market hedge, it can be reduced by investing in non-equities based ETFs.</p>

<p>These strategies usually possess an infrequent rebalance rate, often weekly or monthly, but sometimes annually. Thus they differ substantially from a classic intraday stat-arb quant strategy, but are often nevertheless fully systematic in their approach.</p>

<p>The current version of QuantStart's open-source backtesting and live trading software, <a href="https://github.com/mhallsmoore/qstrader">QSTrader</a>, did not have native support for portfolio rebalancing until last week. Instead users were required to determine their own rebalancing logic and build it into the <code>Strategy</code> and <code>PositionSizer</code> classes themselves.</p>

<p>In this article a basic fixed proportion equities/bonds ETF mix strategy is presented to demonstrate the new functionality of QSTrader. The strategy itself is not novel—it is an example of the classic "60/40" equities/bonds mix—but the rebalancing mechanic within QSTrader allows significantly more flexibility than this. It should provide motivation to try some interesting long-only ETF mixes.</p>

<h2>The Trading Strategy</h2>

<p>The strategy requires trading a couple of Exchange Traded Funds (ETF), which broadly track the performance of US equities (SPY) and US investment-grade bonds (AGG):</p>

<ul>
  <li><strong><a href="https://www.spdrs.com/product/fund.seam?ticker=SPY">SPY</a></strong> - SPDR S&amp;P500 ETF</li>
  <li><strong><a href="https://www.ishares.com/us/products/239458/ishares-core-total-us-bond-market-etf">AGG</a></strong> - iShares Core US Aggregate Bond ETF</li>
</ul>

<p>The strategy simply goes long in both ETFs at the first ending day of the month after commencing, such that 60% of the initial capital is invested in SPY and the remaining 40% is invested in AGG. At every subsequent ending day of the month the portfolio is fully liquidated and rebalanced to ensure that 60% of the current equity is used for SPY and the remaining 40% used for AGG.</p>

<h2>Data</h2>

<p>In order to carry out this strategy it is necessary to have OHLCV pricing data for the period covered by this backtest. In particular it is necessary to download the following:

<ul>
  <li><strong>SPY</strong> - For the period 1st November 2006 to 12th October 2016 (link <a href="http://real-chart.finance.yahoo.com/table.csv?s=SPY&a=10&b=1&c=2006&d=09&e=13&f=2016&g=d&ignore=.csv">here</a>)</li>
  <li><strong>AGG</strong> - For the period 1st November 2006 to 12th October 2016 (link <a href="http://real-chart.finance.yahoo.com/table.csv?s=AGG&a=10&b=1&c=2006&d=09&e=13&f=2016&g=d&ignore=.csv">here</a>)</li>
</ul>

<p>This data will need to placed in the directory specified by the QSTrader settings file if you wish to replicate the results.</p>

<h2>Python QSTrader Implementation</h2>

<p><em>Note that the full code can be found at the bottom of the article. I will only display snippets here. In addition, this strategy is actually a full example in the QSTrader codebase, which can be executed from a fresh install of QSTrader, assuming the data has been obtained separately.</em></p>

<p>There are two new components required to make this monthly rebalance logic work. The first is a subclass of the <code>Strategy</code> base class, namely <code>MonthlyLiquidateRebalanceStrategy</code>. The second is a subclass of the <code>PositionSizer</code> base class, namely <code>LiquidateRebalancePositionSizer</code>.</p>

<p>Some new methods have been added to <code>MonthlyLiquidateRebalanceStrategy</code>. The first is <code>_end_of_month(...)</code>. It simply uses the Python <a href="https://docs.python.org/3/library/calendar.html">calendar</a> module along with the <code>monthrange</code> method to determine if the date passed to it is an end-of-month day:</p>

<pre>
<code class="language-python">def _end_of_month(self, cur_time):
    """
    Determine if the current day is at the end of the month.
    """
    cur_day = cur_time.day
    end_day = calendar.monthrange(cur_time.year, cur_time.month)[1]
    return cur_day == end_day</code>
</pre>

<p>The second method is <code>_create_invested_list</code>, which simply creates a dictionary comprehension of all tickers as keys and boolean <code>False</code> as values. This <code>tickers_invested</code> dict is used for "housekeeping" to check whether an asset has been purchased at the point of carrying out subsequent trading logic.</p>

<p>This is necessary because on the first run through of the code the liquidation of the entire portfolio is not needed since there is nothing in it to liquidate!</p>

<pre>
<code class="language-python">def _create_invested_list(self):
    """
    Create a dictionary with each ticker as a key, with
    a boolean value depending upon whether the ticker has
    been "invested" yet. This is necessary to avoid sending
    a liquidation signal on the first allocation.
    """
    tickers_invested = {ticker: False for ticker in self.tickers}
    return tickers_invested</code>
</pre>

<p>The core logic is encapsulated in <code>calculate_signals</code>. This code initially checks whether this is an end-of-month day for the current OHLCV bar. It then determines whether the portfolio has been purchased, and if so, whether it should liquidate it fully prior to rebalancing.</p>

<p>Irrespective, it simply sends a long signal ("BOT") to the events queue and then updates the <code>tickers_invested</code> dict to show that this ticker has now been purchased at least once:</p>

<pre>
<code class="language-python">def calculate_signals(self, event):
    """
    For a particular received BarEvent, determine whether
    it is the end of the month (for that bar) and generate
    a liquidation signal, as well as a purchase signal,
    for each ticker.
    """
    if (
        event.type in [EventType.BAR, EventType.TICK] and
        self._end_of_month(event.time)
    ):
        ticker = event.ticker
        if self.tickers_invested[ticker]:
            liquidate_signal = SignalEvent(ticker, "EXIT")
            self.events_queue.put(liquidate_signal)
        long_signal = SignalEvent(ticker, "BOT")
        self.events_queue.put(long_signal)
        self.tickers_invested[ticker] = True</code>
</pre>

<p>This wraps up the code for the <code>MonthlyLiquidateRebalanceStrategy</code>. The next object is the <code>LiquidateRebalancePositionSizer</code>.</p>

<p>In the initialisation of the object it is necessary to pass a dictionary containing the initial weights of the tickers:</p>

<pre>
<code class="language-python">def __init__(self, ticker_weights):
    self.ticker_weights = ticker_weights</code>
</pre>

<p>The <code>ticker_weights</code> dict, for this strategy, has the following structure:</p>

<pre>
<code class="language-python">ticker_weights = {
    "SPY": 0.6,
    "AGG": 0.4
}</code>
</pre>

<p>It is easy to see how this can be expanded to have any initial set of ETFs/equities with various weights. At this stage, while not a hard requirement, the code is set up to handle allocations only when the weights add up to 1.0. A weighting in excess of 1.0 would indicate the use of leverage/margin, which is not currently handled in QSTrader.</p>

<p>The main code for <code>LiquidateRebalancePositionSizer</code> is given in the <code>size_order</code> method. It initially asks whether the order received has an "EXIT" (liquidate) action or whether it is a "BOT" long action. This determines how the order is modified.</p>

<p>If it is a liquidate signal then the current quantity is determined and an opposing signal is created to net out the quantity of the position to zero. If instead it is a long signal to purchase shares then the current price of the asset must be determined. This is achieved by querying <code>portfolio.price_handler.tickers[ticker]["adj_close"]</code>.</p>

<p>Once the current price of the asset is determined, the full portfolio equity must also be ascertained. With these two values it is possible to calcualte the new dollar-weighting for that particular asset by multiplying the full equity by the proportion weight of the asset. This is finally converted into an integer value of shares to purchase.</p>

<p><em>Note that the market price and equity value must be divided by <code>PriceParser.PRICE_MULTIPLIER</code> to avoid round-off errors. This feature was described in a <a href="https://www.quantstart.com/articles/kalman-filter-based-pairs-trading-strategy-in-qstrader">previous post</a> and I won't dwell on it here.</em></p>

<pre>
<code class="language-python">def size_order(self, portfolio, initial_order):
    """
    Size the order to reflect the dollar-weighting of the
    current equity account size based on pre-specified
    ticker weights.
    """
    ticker = initial_order.ticker
    if initial_order.action == "EXIT":
        # Obtain current quantity and liquidate
        cur_quantity = portfolio.positions[ticker].quantity
        if cur_quantity > 0:
            initial_order.action = "SLD"
            initial_order.quantity = cur_quantity
        elif cur_quantity < 0:
            initial_order.action = "BOT"
            initial_order.quantity = cur_quantity
        else:
            initial_order.quantity = 0
    else:
        weight = self.ticker_weights[ticker]
        # Determine total portfolio value, work out dollar weight
        # and finally determine integer quantity of shares to purchase
        price = portfolio.price_handler.tickers[ticker]["adj_close"]
        price /= PriceParser.PRICE_MULTIPLIER
        equity = portfolio.equity / PriceParser.PRICE_MULTIPLIER
        dollar_weight = weight * equity
        weighted_quantity = int(floor(dollar_weight / price))
        # Update quantity
        initial_order.quantity = weighted_quantity
    return initial_order</code>
</pre>

<p>The final component of the code is encapsulated in the <code>monthly_liquidate_rebalance_backtest.py</code> file. The full code for this is provided at the end of this article. There is nothing "remarkable" in this file compared to any other backtest setup beyond the specification of the <code>ticker_weights</code> stock weighting dictionary.</p>

<p>Finally, we can run the strategy by downloading the data into the correct directory and typing the following into the terminal:</p>

<pre>
<code class="language-bash">$ python monthly_liquidate_rebalance_backtest.py --tickers=SPY,AGG</code>
</pre>

<p>I'd like to once again thank the many volunteer developers, particularly <a href="https://github.com/ryankennedyio">@ryankennedyio</a>, <a href="https://github.com/femtotrader">@femtotrader</a> and <a href="https://github.com/nwillemse">@nwillemse</a>, for giving their time so freely to the project and producing some great features.</p>

<h2>Strategy Results</h2>

<p>The tearsheet for the strategy is given below:</p>

<p style="text-align:center;">
  <a href="https://s3.amazonaws.com/quantstartmedia/images/qs-qstrader-monthly-rebalance-spy-agg-tearsheet.png">
    <img width="100%" src="https://s3.amazonaws.com/quantstartmedia/images/qs-qstrader-monthly-rebalance-spy-agg-tearsheet.png">
  </a>
</p>

<p><em>Click the image for a larger view.</em></p>

<p>The benchmark is provided by a buy-and-hold portfolio (i.e. no monthly rebalancing) solely of the SPY ETF.</p>

<p>While the backtest shares a similar Sharpe Ratio of 0.3 compared to 0.32 for the benchmark, it has a lower CAGR at 3.31% compared to 4.59%.</p>

<p>The underperformance compared to the benchmark is due to two factors. Namely, that the strategy carries out a full liquidation and repurchase at the end of every month generating transaction costs. In addition the AGG bond fund, while cushioning the blow in 2008, has detracted from the performance of SPY in the last five years.</p>

<p>This motivates two avenues of research.</p>

<p>The first involves minimising transaction costs by avoiding a full liquidation and only rebalancing when necessary. This could be set as some form of thresholding whereby if the 60/40 split deviates too much from this proportion it is necessary to carry out a rebalance. This is in opposition to a rebalance carried out every month irrespective of current proportionality.</p>

<p>The second involves adjusting the ETF mix to increase the Sharpe Ratio. There are a vast number of ETFs out there, with many portfolios beating the benchmark <em>a posteriori</em>. Our task is obviously to decide how to construct such portfolios <em>a priori</em>!</p>

<h2>Next Steps</h2>

<p>The current implementation of QSTrader only supports rebalancing of long-only portfolios with fixed initial weights. Therefore two necessary improvements are to ensure that portfolios with short weightings via margin are supported as well as allowing dynamic adjustments of portfolio weightings through time.</p>

<p>In addition QSTrader will need to support rebalancing at other frequencies including weekly and yearly. Daily rebalancing is harder to support as it involves having access to intraday market data. However it is a planned feature.</p>

<p>Despite the current lack of weekly or yearly rebalancing, the monthly rebalance is extremely flexible. It will allow replication of many long-only strategies currently in use by large asset managers, under the assumption of availability of data.</p>

<p>Many future posts will be devoted to such strategies and, as with this post, they will all contain the full code necessary to replicate the strategies.</p>

<h2>Full Code</h2>

<pre>
<code class="language-python"># monthly_liquidate_rebalance_strategy.py

import calendar

from .base import AbstractStrategy
from ..event import (SignalEvent, EventType)


class MonthlyLiquidateRebalanceStrategy(AbstractStrategy):
    """
    A generic strategy that allows monthly rebalancing of a
    set of tickers, via full liquidation and dollar-weighting
    of new positions.

    Must be used in conjunction with the
    LiquidateRebalancePositionSizer object to work correctly.
    """
    def __init__(self, tickers, events_queue):
        self.tickers = tickers
        self.events_queue = events_queue
        self.tickers_invested = self._create_invested_list()

    def _end_of_month(self, cur_time):
        """
        Determine if the current day is at the end of the month.
        """
        cur_day = cur_time.day
        end_day = calendar.monthrange(cur_time.year, cur_time.month)[1]
        return cur_day == end_day

    def _create_invested_list(self):
        """
        Create a dictionary with each ticker as a key, with
        a boolean value depending upon whether the ticker has
        been "invested" yet. This is necessary to avoid sending
        a liquidation signal on the first allocation.
        """
        tickers_invested = {ticker: False for ticker in self.tickers}
        return tickers_invested

    def calculate_signals(self, event):
        """
        For a particular received BarEvent, determine whether
        it is the end of the month (for that bar) and generate
        a liquidation signal, as well as a purchase signal,
        for each ticker.
        """
        if (
            event.type in [EventType.BAR, EventType.TICK] and
            self._end_of_month(event.time)
        ):
            ticker = event.ticker
            if self.tickers_invested[ticker]:
                liquidate_signal = SignalEvent(ticker, "EXIT")
                self.events_queue.put(liquidate_signal)
            long_signal = SignalEvent(ticker, "BOT")
            self.events_queue.put(long_signal)
            self.tickers_invested[ticker] = True</code>
</pre>

<pre>
<code class="language-python"># rebalance_position_sizer.py

from math import floor

from .base import AbstractPositionSizer
from qstrader.price_parser import PriceParser


class LiquidateRebalancePositionSizer(AbstractPositionSizer):
    """
    Carries out a periodic full liquidation and rebalance of
    the Portfolio.

    This is achieved by determining whether an order type type
    is "EXIT" or "BOT/SLD".

    If the former, the current quantity of shares in the ticker
    is determined and then BOT or SLD to net the position to zero.

    If the latter, the current quantity of shares to obtain is
    determined by prespecified weights and adjusted to reflect
    current account equity.
    """
    def __init__(self, ticker_weights):
        self.ticker_weights = ticker_weights

    def size_order(self, portfolio, initial_order):
        """
        Size the order to reflect the dollar-weighting of the
        current equity account size based on pre-specified
        ticker weights.
        """
        ticker = initial_order.ticker
        if initial_order.action == "EXIT":
            # Obtain current quantity and liquidate
            cur_quantity = portfolio.positions[ticker].quantity
            if cur_quantity > 0:
                initial_order.action = "SLD"
                initial_order.quantity = cur_quantity
            elif cur_quantity < 0:
                initial_order.action = "BOT"
                initial_order.quantity = cur_quantity
            else:
                initial_order.quantity = 0
        else:
            weight = self.ticker_weights[ticker]
            # Determine total portfolio value, work out dollar weight
            # and finally determine integer quantity of shares to purchase
            price = portfolio.price_handler.tickers[ticker]["adj_close"]
            price /= PriceParser.PRICE_MULTIPLIER
            equity = portfolio.equity / PriceParser.PRICE_MULTIPLIER
            dollar_weight = weight * equity
            weighted_quantity = int(floor(dollar_weight / price))
            # Update quantity
            initial_order.quantity = weighted_quantity
        return initial_order</code>
</pre>

<pre>
<code class="language-python"># monthly_liquidate_rebalance_strategy.py

import click

from qstrader import settings
from qstrader.compat import queue
from qstrader.price_parser import PriceParser
from qstrader.price_handler.yahoo_daily_csv_bar import YahooDailyCsvBarPriceHandler
from qstrader.strategy.monthly_liquidate_rebalance import MonthlyLiquidateRebalanceStrategy
from qstrader.strategy import Strategies, DisplayStrategy
from qstrader.position_sizer.rebalance import LiquidateRebalancePositionSizer
from qstrader.risk_manager.example import ExampleRiskManager
from qstrader.portfolio_handler import PortfolioHandler
from qstrader.compliance.example import ExampleCompliance
from qstrader.execution_handler.ib_simulated import IBSimulatedExecutionHandler
from qstrader.statistics.tearsheet import TearsheetStatistics
from qstrader.trading_session.backtest import Backtest


def run(config, testing, tickers, filename):

    # Set up variables needed for backtest
    events_queue = queue.Queue()
    csv_dir = config.CSV_DATA_DIR
    initial_equity = PriceParser.parse(500000.00)

    # Use Yahoo Daily Price Handler
    price_handler = YahooDailyCsvBarPriceHandler(
        csv_dir, events_queue, tickers
    )

    # Use the monthly liquidate and rebalance strategy
    strategy = MonthlyLiquidateRebalanceStrategy(tickers, events_queue)
    strategy = Strategies(strategy, DisplayStrategy())

    # Use the liquidate and rebalance position sizer
    # with prespecified ticker weights
    ticker_weights = {
        "SPY": 0.6,
        "AGG": 0.4,
    }
    position_sizer = LiquidateRebalancePositionSizer(ticker_weights)

    # Use an example Risk Manager
    risk_manager = ExampleRiskManager()

    # Use the default Portfolio Handler
    portfolio_handler = PortfolioHandler(
        initial_equity, events_queue, price_handler,
        position_sizer, risk_manager
    )

    # Use the ExampleCompliance component
    compliance = ExampleCompliance(config)

    # Use a simulated IB Execution Handler
    execution_handler = IBSimulatedExecutionHandler(
        events_queue, price_handler, compliance
    )

    # Use the default Statistics
    title = ["US Equities/Bonds 60/40 ETF Strategy"]
    benchmark = "SPY"
    statistics = TearsheetStatistics(
        config, portfolio_handler, title, benchmark
    )

    # Set up the backtest
    backtest = Backtest(
        price_handler, strategy,
        portfolio_handler, execution_handler,
        position_sizer, risk_manager,
        statistics, initial_equity
    )
    results = backtest.simulate_trading(testing=testing)
    statistics.save(filename)
    return results


@click.command()
@click.option('--config', default=settings.DEFAULT_CONFIG_FILENAME, help='Config filename')
@click.option('--testing/--no-testing', default=False, help='Enable testing mode')
@click.option('--tickers', default='SPY', help='Tickers (use comma)')
@click.option('--filename', default='', help='Pickle (.pkl) statistics filename')
def main(config, testing, tickers, filename):
    tickers = tickers.split(",")
    config = settings.from_file(config, testing)
    run(config, testing, tickers, filename)


if __name__ == "__main__":
    main()</code>
</pre>
        
        
        <script async data-uid="6296c27f4b" src="https://weathered-brook-5281.ck.page/6296c27f4b/index.js"></script>
      </section>
    </div>
    <div class="col-md-4 book-card order-md-1">
      
<div class="sidebar-advert-container">
  <a href="/qsalpha/?ref=art">
    <img class="card-img-top" src="/static/images/qsalpha-sidebar-advert-small.png" alt="QSAlpha">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/qsalpha/?ref=art">QSAlpha</a></h3>
      <p class="card-text medium-text mb-3">Join the QSAlpha research platform that helps fill your strategy research pipeline, diversifies your portfolio and improves your risk-adjusted returns for increased profitability.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/qsalpha/?ref=art">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/quantcademy/?ref=art">
    <img class="card-img-top" src="/static/images/quantcademy-sidebar-advert-small.png" alt="Quantcademy">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/quantcademy/?ref=art">The Quantcademy</a></h3>
      <p class="card-text medium-text mb-3">Join the Quantcademy membership portal that caters to the rapidly-growing retail quant trader community and learn how to increase your strategy profitability.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/quantcademy/?ref=art">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/successful-algorithmic-trading-ebook/">
    <img class="card-img-top" src="/static/images/sat-sidebar-advert-small.png" alt="Successful Algorithmic Trading">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a></h3>
      <p class="card-text medium-text mb-3">How to find new trading strategy ideas and objectively assess them for your portfolio using a Python-based backtesting engine.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/successful-algorithmic-trading-ebook/">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/advanced-algorithmic-trading-ebook/">
    <img class="card-img-top" src="/static/images/aat-sidebar-advert-small.png" alt="Advanced Algorithmic Trading">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a></h3>
      <p class="card-text medium-text mb-3">How to implement advanced trading strategies using time series analysis, machine learning and Bayesian statistics with R and Python.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/advanced-algorithmic-trading-ebook/">Find Out More</a>
        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </div>
</section>

    

<footer>
  <div class="container container-full">
    <section class="mt-1.5 mb-1">
      <div class="row">
        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">QuantStart</li>
            <li class="footer-list-link"><a class="link-fade" href="/about/">About</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/articles/">Articles</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/sitemap/">Sitemap</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Products</li>
            
            <li class="footer-list-link"><a class="link-fade" href="/qsalpha/">QSAlpha</a></li>
            
            
            <li class="footer-list-link"><a class="link-fade" href="/quantcademy/">Quantcademy</a></li>
            
            <li class="footer-list-link"><a class="link-fade" href="/qstrader/">QSTrader</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Legal</li>
            <li class="footer-list-link"><a class="link-fade" href="/privacy-policy/">Privacy Policy</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Social</li>
            <li class="footer-list-link"><a class="link-fade" href="https://twitter.com/quantstart">Twitter</a></li>
            <li class="footer-list-link"><a class="link-fade" href="https://www.youtube.com/channel/UCmVnnZ6Y2TrJtY1eQJN6kWA">YouTube</a></li>
          </ul>
        </div>
      </div>
    </section>

    <div class="row mb-1.5 mt-5">
      <div class="col-12 col-md-9 col-lg-8 col-xl-6">
        <div class="footer-copyright">
          <p>©2012-2023 QuarkGluon Ltd. All rights reserved.</p>
        </div>
      </div>
    </div>
  </div>
</footer>

    
<script src="/static/js/jquery-3.2.1.min.js"></script>
<script src="/static/js/prism.js.min"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/nav.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5383959-5']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="/static/js/highcharts/highcharts.js"></script>
<script type="text/javascript">
  num_colours = 10;
</script>
<script src="/static/js/statistics.js"></script>


  </body>
</html>
